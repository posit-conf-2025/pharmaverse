# tbl_merge()/tbl_stack()

## tbl_merge() for side-by-side tables

```{r}
#| label: 'tbl_merge'
tbl_n <- 
  tbl_summary(adsl, include = ETHNIC, statistic = ETHNIC ~ "{n}") |> 
  modify_header(all_stat_cols() ~ "**N**") |> # update column header
  remove_footnote_header() # remove footnote
tbl_age <-
  tbl_continuous(adsl, include = ETHNIC, variable = AGE, by = ARM2) |> 
  modify_header(all_stat_cols() ~ "**{level}**") # update header

# combine the tables side by side
list(tbl_n, tbl_age) |> 
  tbl_merge(tab_spanner = FALSE) # suppress default header
```

## tbl_stack() to combine vertically

```{r}
#| label: 'tbl_stack'
tbl_drug_a <- filter(adsl, ARM2 == "Placebo") |> 
  tbl_summary(include = ETHNIC)
tbl_drug_b <- filter(adsl, ARM2 == "Xanomeline") |> 
  tbl_summary(include = ETHNIC)

# stack the two tables 
list(tbl_drug_a, tbl_drug_b) |> 
  tbl_stack(group_header = c("Placebo", "Xanomeline"), quiet = TRUE) |> # optionally include headers for each table
  modify_header(all_stat_cols() ~ "**Summary Statistics**")
```

<!-- ## tbl_strata() for stratified tables -->

<!-- ```{r} -->
<!-- tbl_strata( -->
<!--   adsl,  -->
<!--   strata = ARM2,  -->
<!--   ~ .x |>  -->
<!--     tbl_wide_summary(include = c(ETHNIC, FEMALE)) -->
<!-- ) -->
<!-- ``` -->

<!-- The default is to combine stratified tables with `tbl_merge()`. -->


<!-- ## tbl_strata() for stratified tables -->

<!-- We can also stack the tables. -->

<!-- ```{r} -->
<!-- tbl_strata( -->
<!--   adsl,  -->
<!--   strata = ARM2,  -->
<!--   ~ .x |>  -->
<!--     tbl_summary(include = ETHNIC), -->
<!--   .combine_with = "tbl_stack" -->
<!-- ) -->
<!-- ``` -->

## Define custom function `tbl_cmh()`

<p align="center"><img src="images/tbl_cmh.png" width=68%></p>

## Define custom function `tbl_cmh()`

<p align="center"><img src="images/tbl_cmh_markup.png" width=68%></p>

## Cobbling Tables Together

- The {gtsummary} package makes it simple to break complex tables into their simple parts and cobble them together in the end.

- Moreover, the internal structure of a gtsummary table is **super simple**: 

    - A data frame
    
    - Instructions to print that data frame to make it cute.

- Modify the underlying data frame directly with `modify_table_body()`.

```{r}
tbl_summary(adsl, include = c(AGE, ETHNIC), by = ARM2) |> 
  pluck("table_body")
```
